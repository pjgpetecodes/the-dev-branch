@page
@model IndexModel
@{
    ViewData["Title"] = "The Dev Branch";
    ViewData["BodyClass"] = "game-page";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Dev Branch</title>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>
    <!-- Game Header -->
    <header id="gameHeader" class="game-header">
        <a href="/" class="game-title">💻 The Dev Branch 💻</a>
        <div class="game-nav">
            <a href="/" class="nav-link">Home</a>
            <a href="/Privacy" class="nav-link">Privacy</a>
        </div>
    </header>

    <!-- Notification Area -->
    <div id="notificationArea" class="notification-area"></div>

    <!-- Small Game Logo (shown during gameplay) -->
    <div id="gameLogo" class="game-logo hidden">
        💻 The Dev Branch 💻
    </div>

    <div class="container">

        <!-- Welcome Header -->
        <div id="welcomeHeader" class="hidden"></div>

        <!-- Lobby Screen -->
        <div id="lobby">
            <div class="how-to-play-box">
                <button class="how-to-play-toggle" onclick="toggleHowToPlay()" id="howToPlayBtn">
                    <span class="toggle-icon">▼</span> How to Play:
                </button>
                <ol class="how-to-play-list" id="howToPlayContent">
                    <li>Enter your name</li>
                    <li>Create a new room or join an existing room with a code</li>
                    <li>Wait for at least 3 players to join</li>
                    <li>Once everyone is ready, the game will automatically begin</li>
                </ol>
            </div>
            <div class="input-group">
                <div id="nameErrorMain" class="name-error hidden"></div>
                <label for="playerName">Enter a Unique Username:</label>
                <input type="text" id="playerName" placeholder="Enter your name" />
            </div>
            
            <!-- Tabbed Room Options Section -->
            <div class="room-tabs-container">
                <div class="room-tabs">
                    <button class="tab-btn active" onclick="switchRoomTab('create')">Create Room</button>
                    <button class="tab-btn" onclick="switchRoomTab('join')">Join Room</button>
                </div>
                
                <!-- Create Room Tab -->
                <div id="createTab" class="tab-content active">
                    <button id="createRoomBtn" class="btn-primary btn-large" onclick="createRoom()">Create Room</button>
                </div>
                
                <!-- Join Room Tab -->
                <div id="joinTab" class="tab-content">
                    <div class="input-group">
                        <div id="roomIdErrorMain" class="name-error hidden"></div>
                        <label for="roomCode">Enter Room Code:</label>
                        <input type="text" id="roomCode" placeholder="5-character code" maxlength="5" style="text-transform: uppercase;" />
                    </div>
                    <button id="joinRoomBtn" class="btn-primary btn-large" onclick="joinRoom()">Join Room</button>
                </div>
            </div>
            
            <!-- Start Game Button (shown when in room) -->
            <div id="startGameContainer" class="hidden">
                <button id="startGameBtn" class="btn-primary btn-large" onclick="startGame()">Start Game</button>
            </div>
            
            <button id="leaveRoomBtn" class="btn-danger hidden" onclick="leaveRoom()">Leave Room</button>
            
            <!-- Share Link Section -->
            <div id="shareLinkSection" class="hidden share-link-section">
                <h3 class="share-link-title">Share This Room</h3>
                <div class="share-link-container">
                    <input type="text" id="shareLinkInput" class="share-link-input" readonly />
                    <button class="btn-copy" onclick="copyShareLink()">Copy Link</button>
                </div>
            </div>
            
            <div id="lobbyStatus" class="lobby-status hidden"></div>

            <!-- Rounds info (shown in lobby) -->
            <div id="roundsSelector" class="hidden rounds-info-box">
                <h3>Rounds</h3>
                <p class="rounds-info-text">This game will play <strong><span id="roundsInfoValue">7</span></strong> rounds.</p>
            </div>

            <!-- Rounds modal (shown to room creator) -->
            <div id="roundsModal" class="modal-overlay hidden">
                <div class="modal-content">
                    <h3>Set Number of Rounds</h3>
                    <p class="modal-description">Choose how many rounds to play in this room.</p>
                    <div class="input-group">
                        <label for="roundsModalInput">Rounds to play:</label>
                        <input type="number" id="roundsModalInput" min="1" max="50" value="7" />
                    </div>
                    <div class="modal-actions">
                        <button id="confirmRoundsBtn" class="btn-primary" onclick="confirmRounds()">Confirm</button>
                    </div>
                </div>
            </div>

            <!-- Name Entry Modal (shown when joining via link) -->
            <div id="nameEntryModal" class="modal-overlay hidden">
                <div class="modal-content">
                    <h3>Join Room</h3>
                    <p class="modal-description">Enter your unique name to join this game room.</p>
                    <div class="input-group">
                        <div id="nameErrorModal" class="name-error hidden"></div>
                        <label for="modalPlayerName">Your Name:</label>
                        <input type="text" id="modalPlayerName" placeholder="Enter your name" />
                    </div>
                    <div class="modal-actions">
                        <button id="confirmNameBtn" class="btn-primary" onclick="confirmNameEntryFromModal()">Join Room</button>
                    </div>
                </div>
            </div>

            <!-- Idle Warning Modal -->
            <div id="idleWarningModal" class="modal-overlay hidden">
                <div class="modal-content">
                    <h3>Room Inactivity Warning</h3>
                    <p class="modal-description">
                        This room will close in <strong><span id="idleWarningCountdown">60</span> seconds</strong> due to inactivity.
                    </p>
                    <div class="modal-actions">
                        <button id="extendRoomBtn" class="btn-primary" onclick="extendRoomIdle()">Keep Room Active</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Board -->
        <div id="gameBoard">
            <!-- Game Header -->
            <div class="game-header">
                <div class="game-info">
                    Room: <span id="roomIdDisplay"></span>
                </div>
                <div class="game-info">
                    <span id="roundLabel">Round: <span id="roundNumber">1</span> / <span id="totalRoundsDisplay">7</span></span>
                </div>
                <button id="leaveGameBtn" class="btn-danger hidden" onclick="leaveRoom()" style="margin-left: auto;">Leave Game</button>
            </div>

            <!-- Players -->
            <div class="players-section" id="playersContainer"></div>

            <!-- Status Message -->
            <div id="statusMessage"></div>

            <!-- Game Over Display -->
            <div id="gameOverDisplay" class="hidden"></div>

            <!-- Cards Display Section (Black Card + Submitted Cards) -->
            <div class="cards-display-wrapper">
                <!-- Black Card -->
                <div class="black-card-container">
                    <div class="card black-card" id="blackCard">
                        Waiting for game to start...
                    </div>
                </div>

                <!-- Submitted Cards -->
                <div id="submittedCardsSection" class="submitted-cards-section hidden">
                    <h2 id="submittedCardsTitle" style="text-align: center;">Submitted Cards:</h2>
                    <div class="submitted-cards-container" id="submittedCardsContainer"></div>
                </div>
            </div>

            <!-- Player's Hand -->
            <div class="hand-section">
                <h2>Your Hand</h2>
                <div class="cards-container" id="handContainer">
                    <p class="waiting-cards-text">Waiting for cards...</p>
                </div>
                <div class="hand-section-submit">
                    <button id="submitCardsBtn" class="btn-primary hidden" onclick="submitSelectedCards()">Submit Cards</button>
                </div>
            </div>
        </div>

        <!-- Player Left Mid-Game Modals -->
        <!-- Player Left Mid-Game Modal (for non-creators) -->
        <div id="playerLeftModal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Player Left</h3>
                <p class="modal-description">
                    <strong id="leftPlayerName"></strong> has left the game.
                </p>
                <p class="modal-description" id="creatorWaitingMessage">
                    The room creator is deciding what to do...
                </p>
            </div>
        </div>

        <!-- Player Left Mid-Game Modal (for room creator) -->
        <div id="playerLeftCreatorModal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Player Left</h3>
                <p class="modal-description">
                    <strong id="leftPlayerNameCreator"></strong> has left the game!
                </p>
                <p class="modal-description">
                    What would you like to do?
                </p>
                <div class="modal-actions-creator">
                    <button id="waitBtn" class="btn-secondary" onclick="handleWait()">Wait for <strong id="waitPlayerName"></strong> to Return</button>
                    <button id="restartGameBtn" class="btn-secondary hidden" onclick="handleRestartGame()">Restart Game</button>
                    <button id="exitGameBtn" class="btn-danger hidden" onclick="handleQuitGame()">Exit Game</button>
                </div>
            </div>
        </div>

        <!-- Not Enough Players Modal (for non-creators) -->
        <div id="notEnoughPlayersModal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Not Enough Players</h3>
                <p class="modal-description">
                    <strong id="leftPlayerNameNotEnough"></strong> has left the game.
                </p>
                <p class="modal-description">
                    Only <strong id="remainingPlayerCount">0</strong> players remain. You need at least 3 to continue.
                </p>
                <p class="modal-description" id="creatorDecidingMessage">
                    The room creator is deciding what to do...
                </p>
            </div>
        </div>

        <!-- Not Enough Players Creator Modal -->
        <div id="notEnoughPlayersCreatorModal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Not Enough Players!</h3>
                <p class="modal-description">
                    <strong id="leftPlayerNameCreatorNotEnough"></strong> has left the game.
                </p>
                <p class="modal-description">
                    Only <strong id="remainingPlayerCountCreator">0</strong> players remain. You need at least 3 to play.
                </p>
                <p class="modal-description">
                    What would you like to do?
                </p>
                <div class="modal-actions-creator">
                    <button id="waitForMoreBtn" class="btn-secondary" onclick="handleWaitForMorePlayers()">Wait for <strong id="waitPlayerName2"></strong> to Return</button>
                    <button id="quitGameBtn" class="btn-danger" onclick="handleQuitGame()">Quit Game</button>
                </div>
            </div>
        </div>
    </div>

    <script src="~/lib/signalr/dist/browser/signalr.min.js"></script>
    
    <!-- Load JavaScript modules in dependency order -->
    <script src="~/js/game-state.js"></script>
    <script src="~/js/helpers.js"></script>
    <script src="~/js/ui-notifications.js"></script>
    <script src="~/js/ui-modals.js"></script>
    <script src="~/js/ui-lobby.js"></script>
    <script src="~/js/ui-game.js"></script>
    <script src="~/js/signalr-events.js"></script>
    <script src="~/js/demo-mode.js"></script>
    <script src="~/js/game.js"></script>
</body>
</html>
