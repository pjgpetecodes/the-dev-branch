@page
@model IndexModel
@{
    ViewData["Title"] = "Devs Against Life";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devs Against Life</title>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>
    <div class="container">

        <!-- Welcome Header -->
        <div id="welcomeHeader" class="hidden"></div>

        <!-- Lobby Screen -->
        <div id="lobby">
            <div class="how-to-play-box">
                <h2 class="how-to-play-title">How to Play:</h2>
                <ol class="how-to-play-list">
                    <li>Enter your name</li>
                    <li>Create a new room by entering a unique Room ID, or join an existing room</li>
                    <li>Click "Join Room" to enter the game lobby</li>
                    <li>Wait for at least 3 players to join</li>
                    <li>Click "Start Game" to begin playing</li>
                </ol>
            </div>
            <div class="input-group">
                <div id="nameErrorMain" class="name-error hidden"></div>
                <label for="playerName">Enter a Unique Username:</label>
                <input type="text" id="playerName" placeholder="Enter your name" />
            </div>
            <div class="input-group">
                <label for="roomId">Room ID:</label>
                <input type="number" id="roomId" placeholder="Enter or create room ID" min="1" step="1" inputmode="numeric" />
            </div>
            <button id="joinRoomBtn" class="btn-primary" onclick="joinRoom()">Join Room</button>
            <button id="leaveRoomBtn" class="btn-danger hidden" onclick="leaveRoom()">Leave Room</button>
            <button id="startGameBtn" class="btn-secondary" onclick="startGame()" disabled>Start Game</button>
            
            <!-- Share Link Section -->
            <div id="shareLinkSection" class="hidden share-link-section">
                <h3 class="share-link-title">Share This Room</h3>
                <div class="share-link-container">
                    <input type="text" id="shareLinkInput" class="share-link-input" readonly />
                    <button class="btn-copy" onclick="copyShareLink()">Copy Link</button>
                </div>
            </div>
            
            <div id="lobbyStatus" class="lobby-status"></div>

            <!-- Rounds info (shown in lobby) -->
            <div id="roundsSelector" class="hidden rounds-info-box">
                <h3>Rounds</h3>
                <p class="rounds-info-text">This game will play <strong><span id="roundsInfoValue">7</span></strong> rounds.</p>
            </div>

            <!-- Rounds modal (shown to room creator) -->
            <div id="roundsModal" class="modal-overlay hidden">
                <div class="modal-content">
                    <h3>Set Number of Rounds</h3>
                    <p class="modal-description">Choose how many rounds to play in this room.</p>
                    <div class="input-group">
                        <label for="roundsModalInput">Rounds to play:</label>
                        <input type="number" id="roundsModalInput" min="1" max="50" value="7" />
                    </div>
                    <div class="modal-actions">
                        <button id="confirmRoundsBtn" class="btn-primary" onclick="confirmRounds()">Confirm</button>
                    </div>
                </div>
            </div>

            <!-- Name Entry Modal (shown when joining via link) -->
            <div id="nameEntryModal" class="modal-overlay hidden">
                <div class="modal-content">
                    <h3>Join Room</h3>
                    <p class="modal-description">Enter your unique name to join this game room.</p>
                    <div class="input-group">
                        <div id="nameErrorModal" class="name-error hidden"></div>
                        <label for="modalPlayerName">Your Name:</label>
                        <input type="text" id="modalPlayerName" placeholder="Enter your name" />
                    </div>
                    <div class="modal-actions">
                        <button id="confirmNameBtn" class="btn-primary" onclick="confirmNameEntryFromModal()">Join Room</button>
                    </div>
                </div>
            </div>

            <!-- Idle Warning Modal -->
            <div id="idleWarningModal" class="modal-overlay hidden">
                <div class="modal-content">
                    <h3>Room Inactivity Warning</h3>
                    <p class="modal-description">
                        This room will close in <strong><span id="idleWarningCountdown">60</span> seconds</strong> due to inactivity.
                    </p>
                    <div class="modal-actions">
                        <button id="extendRoomBtn" class="btn-primary" onclick="extendRoomIdle()">Keep Room Active</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Board -->
        <div id="gameBoard">
            <!-- Game Header -->
            <div class="game-header">
                <div class="game-info">
                    Room: <span id="roomIdDisplay"></span>
                </div>
                <div class="game-info">
                    <span id="roundLabel">Round: <span id="roundNumber">1</span> / <span id="totalRoundsDisplay">7</span></span>
                </div>
            </div>

            <!-- Players -->
            <div class="players-section" id="playersContainer"></div>

            <!-- Status Message -->
            <div id="statusMessage"></div>

            <!-- Black Card -->
            <div class="black-card-container">
                <div class="card black-card" id="blackCard">
                    Waiting for game to start...
                </div>
            </div>

            <!-- Winner Display -->
            <div id="winnerDisplay" class="hidden"></div>

            <!-- Game Over Display -->
            <div id="gameOverDisplay" class="hidden"></div>

            <!-- Submitted Cards -->
            <div id="submittedCardsSection" class="submitted-cards-section hidden">
                <h2 id="submittedCardsTitle" style="text-align: center;">Submitted Cards:</h2>
                <div class="submitted-cards-container" id="submittedCardsContainer"></div>
            </div>

            <!-- Player's Hand -->
            <div class="hand-section">
                <h2>Your Hand</h2>
                <div class="cards-container" id="handContainer">
                    <p class="waiting-cards-text">Waiting for cards...</p>
                </div>
                <div class="hand-section-submit">
                    <button id="submitCardsBtn" class="btn-primary hidden" onclick="submitSelectedCards()">Submit Cards</button>
                </div>
            </div>

            <!-- Next Round Button -->
            <div class="next-round-section">
                <button id="nextRoundBtn" class="btn-primary hidden" onclick="nextRound()">Next Round</button>
            </div>
        </div>
    </div>

    <script src="~/lib/signalr/dist/browser/signalr.min.js"></script>
    <script src="~/js/game.js"></script>
</body>
</html>
